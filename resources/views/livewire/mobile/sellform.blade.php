<div class="p-3">
    <div class="bg-white rounded-2xl shadow p-6" dir="rtl">
        <h1 class="text-xl font-bold text-center mb-6">فورم فروشات</h1>
        @if (session()->has('success'))
            <div class="bg-green-100 text-green-800 p-3 rounded-xl mb-4 text-center success-message">
                {{ session('success') }}
            </div>
        @endif
        @if (session()->has('error'))
            <div class="bg-red-100 text-red-800 p-3 rounded-xl mb-4 text-center">
                {{ session('error') }}
            </div>
        @endif
        <div class="flex gap-2 mb-6">
            <button type="button" wire:click="showLoan"
                class="flex-1 py-2 rounded-lg text-white {{ $table=='loan'?'bg-blue-900':'bg-blue-600' }}">
                فروش پرچون
            </button>
            <button type="button" wire:click="showCash"
                class="flex-1 py-2 rounded-lg text-white {{ $table=='cash'?'bg-blue-900':'bg-blue-600' }}">
                فروش عمده
            </button>
        </div>
        <div wire:key="form-{{ $formKey }}">
            <form wire:submit.prevent="save">
                @if($table == 'loan')
                    <div class="flex flex-col md:flex-row gap-4 mb-2">
                        <div class="w-full md:w-1/2">
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-gray-400">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M8.5 21H4C4 17.134 7.13401 14 11 14C11.1681 14 11.3348 14.0059 11.5 14.0176M15 7C15 9.20914 13.2091 11 11 11C8.79086 11 7 9.20914 7 7C7 4.79086 8.79086 3 11 3C13.2091 3 15 4.79086 15 7ZM12.5898 21L14.6148 20.595C14.7914 20.5597 14.8797 20.542 14.962 20.5097C15.0351 20.4811 15.1045 20.4439 15.1689 20.399C15.2414 20.3484 15.3051 20.2848 15.4324 20.1574L19.5898 16C20.1421 15.4477 20.1421 14.5523 19.5898 14C19.0376 13.4477 18.1421 13.4477 17.5898 14L13.4324 18.1574C13.3051 18.2848 13.2414 18.3484 13.1908 18.421C13.1459 18.4853 13.1088 18.5548 13.0801 18.6279C13.0478 18.7102 13.0302 18.7985 12.9948 18.975L12.5898 21Z" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                                </span>
                                <input wire:model="loan_customer_name"   class="input-field"  placeholder="نام مشتری">
                            </div>
                            @error('loan_customer_name')
                                <span class="text-red-600 text-xs">{{ $message }}</span>
                            @enderror
                        </div>
                        <div class="w-full md:w-1/2">
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-gray-400">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M16.1007 13.359L15.5719 12.8272H15.5719L16.1007 13.359ZM16.5562 12.9062L17.085 13.438H17.085L16.5562 12.9062ZM18.9728 12.5894L18.6146 13.2483L18.9728 12.5894ZM20.8833 13.628L20.5251 14.2869L20.8833 13.628ZM21.4217 16.883L21.9505 17.4148L21.4217 16.883ZM20.0011 18.2954L19.4723 17.7636L20.0011 18.2954ZM18.6763 18.9651L18.7459 19.7119H18.7459L18.6763 18.9651ZM8.81536 14.7266L9.34418 14.1947L8.81536 14.7266ZM4.00289 5.74561L3.2541 5.78816L3.2541 5.78816L4.00289 5.74561ZM10.4775 7.19738L11.0063 7.72922H11.0063L10.4775 7.19738ZM10.6342 4.54348L11.2346 4.09401L10.6342 4.54348ZM9.37326 2.85908L8.77286 3.30855V3.30855L9.37326 2.85908ZM6.26145 2.57483L6.79027 3.10667H6.79027L6.26145 2.57483ZM4.69185 4.13552L4.16303 3.60368H4.16303L4.69185 4.13552ZM12.0631 11.4972L12.5919 10.9654L12.0631 11.4972ZM16.6295 13.8909L17.085 13.438L16.0273 12.3743L15.5719 12.8272L16.6295 13.8909ZM18.6146 13.2483L20.5251 14.2869L21.2415 12.9691L19.331 11.9305L18.6146 13.2483ZM20.8929 16.3511L19.4723 17.7636L20.5299 18.8273L21.9505 17.4148L20.8929 16.3511ZM18.6067 18.2184C17.1568 18.3535 13.4056 18.2331 9.34418 14.1947L8.28654 15.2584C12.7186 19.6653 16.9369 19.8805 18.7459 19.7119L18.6067 18.2184ZM9.34418 14.1947C5.4728 10.3453 4.83151 7.10765 4.75168 5.70305L3.2541 5.78816C3.35456 7.55599 4.14863 11.144 8.28654 15.2584L9.34418 14.1947ZM10.7195 8.01441L11.0063 7.72922L9.9487 6.66555L9.66189 6.95073L10.7195 8.01441ZM11.2346 4.09401L9.97365 2.40961L8.77286 3.30855L10.0338 4.99296L11.2346 4.09401ZM5.73263 2.04299L4.16303 3.60368L5.22067 4.66736L6.79027 3.10667L5.73263 2.04299ZM10.1907 7.48257C9.66189 6.95073 9.66117 6.95144 9.66045 6.95216C9.66021 6.9524 9.65949 6.95313 9.659 6.95362C9.65802 6.95461 9.65702 6.95561 9.65601 6.95664C9.65398 6.95871 9.65188 6.96086 9.64972 6.9631C9.64539 6.96759 9.64081 6.97245 9.63599 6.97769C9.62634 6.98816 9.61575 7.00014 9.60441 7.01367C9.58174 7.04072 9.55605 7.07403 9.52905 7.11388C9.47492 7.19377 9.41594 7.2994 9.36589 7.43224C9.26376 7.70329 9.20901 8.0606 9.27765 8.50305C9.41189 9.36833 10.0078 10.5113 11.5343 12.0291L12.5919 10.9654C11.1634 9.54499 10.8231 8.68059 10.7599 8.27309C10.7298 8.07916 10.761 7.98371 10.7696 7.96111C10.7748 7.94713 10.7773 7.9457 10.7709 7.95525C10.7677 7.95992 10.7624 7.96723 10.7541 7.97708C10.75 7.98201 10.7451 7.98759 10.7394 7.99381C10.7365 7.99692 10.7335 8.00019 10.7301 8.00362C10.7285 8.00534 10.7268 8.00709 10.725 8.00889C10.7241 8.00979 10.7232 8.0107 10.7223 8.01162C10.7219 8.01208 10.7212 8.01278 10.7209 8.01301C10.7202 8.01371 10.7195 8.01441 10.1907 7.48257ZM11.5343 12.0291C13.0613 13.5474 14.2096 14.1383 15.0763 14.2713C15.5192 14.3392 15.8763 14.285 16.1472 14.1841C16.28 14.1346 16.3858 14.0763 16.4658 14.0227C16.5058 13.9959 16.5392 13.9704 16.5663 13.9479C16.5799 13.9367 16.5919 13.9262 16.6024 13.9166C16.6077 13.9118 16.6126 13.9073 16.6171 13.903C16.6194 13.9008 16.6215 13.8987 16.6236 13.8967C16.6246 13.8957 16.6256 13.8947 16.6266 13.8937C16.6271 13.8932 16.6279 13.8925 16.6281 13.8923C16.6288 13.8916 16.6295 13.8909 16.1007 13.359C15.5719 12.8272 15.5726 12.8265 15.5733 12.8258C15.5735 12.8256 15.5742 12.8249 15.5747 12.8244C15.5756 12.8235 15.5765 12.8226 15.5774 12.8217C15.5793 12.82 15.581 12.8183 15.5827 12.8166C15.5862 12.8133 15.5895 12.8103 15.5926 12.8074C15.5988 12.8018 15.6044 12.7969 15.6094 12.7929C15.6192 12.7847 15.6265 12.7795 15.631 12.7764C15.6403 12.7702 15.6384 12.773 15.6236 12.7785C15.5991 12.7876 15.501 12.8189 15.3038 12.7886C14.8905 12.7253 14.02 12.3853 12.5919 10.9654L11.5343 12.0291ZM9.97365 2.40961C8.95434 1.04802 6.94996 0.83257 5.73263 2.04299L6.79027 3.10667C7.32195 2.578 8.26623 2.63181 8.77286 3.30855L9.97365 2.40961ZM4.75168 5.70305C4.73201 5.35694 4.89075 4.9954 5.22067 4.66736L4.16303 3.60368C3.62571 4.13795 3.20329 4.89425 3.2541 5.78816L4.75168 5.70305ZM19.4723 17.7636C19.1975 18.0369 18.9029 18.1908 18.6067 18.2184L18.7459 19.7119C19.4805 19.6434 20.0824 19.2723 20.5299 18.8273L19.4723 17.7636ZM11.0063 7.72922C11.9908 6.7503 12.064 5.2019 11.2346 4.09401L10.0338 4.99295C10.4373 5.53193 10.3773 6.23938 9.9487 6.66555L11.0063 7.72922ZM20.5251 14.2869C21.3429 14.7315 21.4703 15.7769 20.8929 16.3511L21.9505 17.4148C23.2908 16.0821 22.8775 13.8584 21.2415 12.9691L20.5251 14.2869ZM17.085 13.438C17.469 13.0562 18.0871 12.9616 18.6146 13.2483L19.331 11.9305C18.2474 11.3414 16.9026 11.5041 16.0273 12.3743L17.085 13.438Z" fill="#1C274C"></path> </g></svg>
                                </span>
                                <input wire:model="loan_phone"  class="input-field"  placeholder="شماره تماس">
                            </div>
                            @error('loan_phone')
                                <span class="text-red-600 text-xs">{{ $message }}</span>
                            @enderror
                        </div>
                    </div>
                    @foreach($loan_models as $index => $model)
                        @php
                            $lp = $loan_profit[$index] ?? 0;
                            $loanProfitClass =
                                ((float)$lp > 0) ? 'bg-green-100 border-green-200 text-green-800' :
                                (((float)$lp < 0) ? 'bg-red-100 border-red-200 text-red-800' :
                                'bg-gray-100 border-gray-200 text-gray-700');
                        @endphp
                        <div class="">
                            <div class="flex flex-col md:flex-row gap-4 mb-2">
                                <div class="relative w-full md:w-1/2">
                                    <select wire:model.live="loan_models.{{ $index }}"
                                        class="input-field">
                                        <option value="">انتخاب دستگاه</option>
                                        @foreach($devices as $device)
                                            <option value="{{ $device->id }}">
                                                {{ $device->model }}
                                            </option>
                                        @endforeach
                                    </select>
                                    @error('loan_models')
                                        <span class="text-red-600 text-xs">{{ $message }}</span>
                                    @enderror
                                </div>
                                <div class="relative w-full md:w-1/2">
                                    <span class="absolute left-3 top-3 text-gray-400">
                                        <svg fill="#000000" width="20" height="20" viewBox="0 0 56 56" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M 47.6171 21.4023 C 48.8591 21.4023 49.5157 20.7227 49.5157 19.4805 L 49.5157 13.7383 C 49.5157 8.9102 47.0780 6.4961 42.1562 6.4961 L 36.4374 6.4961 C 35.1952 6.4961 34.5155 7.1758 34.5155 8.3711 C 34.5155 9.5898 35.1952 10.2696 36.4374 10.2696 L 42.1093 10.2696 C 44.4062 10.2696 45.7421 11.5118 45.7421 13.9492 L 45.7421 19.4805 C 45.7421 20.7227 46.4218 21.4023 47.6171 21.4023 Z M 8.3827 21.4023 C 9.6015 21.4023 10.2577 20.7227 10.2577 19.4805 L 10.2577 13.9492 C 10.2577 11.5118 11.5702 10.2696 13.9140 10.2696 L 19.5858 10.2696 C 20.8046 10.2696 21.4843 9.5898 21.4843 8.3711 C 21.4843 7.1758 20.8046 6.4961 19.5858 6.4961 L 13.8436 6.4961 C 8.9687 6.4961 6.4843 8.9102 6.4843 13.7383 L 6.4843 19.4805 C 6.4843 20.7227 7.1640 21.4023 8.3827 21.4023 Z M 17.6405 36.9649 L 19.2108 36.9649 L 19.2108 19.0352 L 17.6405 19.0352 Z M 21.2030 36.9649 L 24.1796 36.9649 L 24.1796 19.0352 L 21.2030 19.0352 Z M 25.5155 36.9649 L 27.3905 36.9649 L 27.3905 19.0352 L 25.5155 19.0352 Z M 29.0546 36.9649 L 31.9608 36.9649 L 31.9608 19.0352 L 29.0546 19.0352 Z M 33.1562 36.9649 L 35.4530 36.9649 L 35.4530 19.0352 L 33.1562 19.0352 Z M 36.2968 36.9649 L 37.7733 36.9649 L 37.7733 19.0352 L 36.2968 19.0352 Z M 13.8436 49.5039 L 19.5858 49.5039 C 20.8046 49.5039 21.4843 48.8242 21.4843 47.6289 C 21.4843 46.4102 20.8046 45.7305 19.5858 45.7305 L 13.9140 45.7305 C 11.5702 45.7305 10.2577 44.4883 10.2577 42.0508 L 10.2577 36.5196 C 10.2577 35.2774 9.5780 34.5977 8.3827 34.5977 C 7.1405 34.5977 6.4843 35.2774 6.4843 36.5196 L 6.4843 42.2383 C 6.4843 47.0898 8.9687 49.5039 13.8436 49.5039 Z M 36.4374 49.5039 L 42.1562 49.5039 C 47.0780 49.5039 49.5157 47.0664 49.5157 42.2383 L 49.5157 36.5196 C 49.5157 35.2774 48.8360 34.5977 47.6171 34.5977 C 46.3984 34.5977 45.7421 35.2774 45.7421 36.5196 L 45.7421 42.0508 C 45.7421 44.4883 44.4062 45.7305 42.1093 45.7305 L 36.4374 45.7305 C 35.1952 45.7305 34.5155 46.4102 34.5155 47.6289 C 34.5155 48.8242 35.1952 49.5039 36.4374 49.5039 Z"></path></g></svg>
                                    </span>
                                    <input wire:model="loan_number" readonly class="input-field" placeholder="شماره فاکتور">
                                    @error('loan_number')
                                        <span class="text-red-600 text-xs">{{ $message }}</span>
                                    @enderror
                                </div>
                            </div>
                            <div class="flex flex-col md:flex-row gap-4 mb-2">
                                <div class="relative w-full md:w-1/2">
                                    <span class="absolute left-3 top-3 text-gray-400">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M11.7255 17.1019C11.6265 16.8844 11.4215 16.7257 11.1734 16.6975C10.9633 16.6735 10.7576 16.6285 10.562 16.5636C10.4743 16.5341 10.392 16.5019 10.3158 16.4674L10.4424 16.1223C10.5318 16.1622 10.6239 16.1987 10.7182 16.2317L10.7221 16.2331L10.7261 16.2344C11.0287 16.3344 11.3265 16.3851 11.611 16.3851C11.8967 16.3851 12.1038 16.3468 12.2629 16.2647L12.2724 16.2598L12.2817 16.2544C12.5227 16.1161 12.661 15.8784 12.661 15.6021C12.661 15.2955 12.4956 15.041 12.2071 14.9035C12.062 14.8329 11.8559 14.7655 11.559 14.6917C11.2545 14.6147 10.9987 14.533 10.8003 14.4493C10.6553 14.3837 10.5295 14.279 10.4161 14.1293C10.3185 13.9957 10.2691 13.7948 10.2691 13.5319C10.2691 13.2147 10.3584 12.9529 10.5422 12.7315C10.7058 12.5375 10.9381 12.4057 11.2499 12.3318C11.4812 12.277 11.6616 12.1119 11.7427 11.8987C11.8344 12.1148 12.0295 12.2755 12.2723 12.3142C12.4751 12.3465 12.6613 12.398 12.8287 12.4677L12.7122 12.8059C12.3961 12.679 12.085 12.6149 11.7841 12.6149C10.7848 12.6149 10.7342 13.3043 10.7342 13.4425C10.7342 13.7421 10.896 13.9933 11.1781 14.1318L11.186 14.1357L11.194 14.1393C11.3365 14.2029 11.5387 14.2642 11.8305 14.3322C12.1322 14.4004 12.3838 14.4785 12.5815 14.5651L12.5856 14.5669L12.5897 14.5686C12.7365 14.6297 12.8624 14.7317 12.9746 14.8805L12.9764 14.8828L12.9782 14.8852C13.0763 15.012 13.1261 15.2081 13.1261 15.4681C13.1261 15.7682 13.0392 16.0222 12.8604 16.2447C12.7053 16.4377 12.4888 16.5713 12.1983 16.6531C11.974 16.7163 11.8 16.8878 11.7255 17.1019Z" fill="#000000"></path> <path d="M11.9785 18H11.497C11.3893 18 11.302 17.9105 11.302 17.8V17.3985C11.302 17.2929 11.2219 17.2061 11.1195 17.1944C10.8757 17.1667 10.6399 17.115 10.412 17.0394C10.1906 16.9648 9.99879 16.8764 9.83657 16.7739C9.76202 16.7268 9.7349 16.6312 9.76572 16.5472L10.096 15.6466C10.1405 15.5254 10.284 15.479 10.3945 15.5417C10.5437 15.6262 10.7041 15.6985 10.8755 15.7585C11.131 15.8429 11.3762 15.8851 11.611 15.8851C11.8129 15.8851 11.9572 15.8628 12.0437 15.8181C12.1302 15.7684 12.1735 15.6964 12.1735 15.6021C12.1735 15.4929 12.1158 15.411 12.0004 15.3564C11.8892 15.3018 11.7037 15.2422 11.4442 15.1777C11.1104 15.0933 10.8323 15.0039 10.6098 14.9096C10.3873 14.8103 10.1936 14.6514 10.0288 14.433C9.86396 14.2096 9.78156 13.9092 9.78156 13.5319C9.78156 13.095 9.91136 12.7202 10.1709 12.4074C10.4049 12.13 10.7279 11.9424 11.1401 11.8447C11.2329 11.8227 11.302 11.7401 11.302 11.6425V11.2C11.302 11.0895 11.3893 11 11.497 11H11.9785C12.0862 11 12.1735 11.0895 12.1735 11.2V11.6172C12.1735 11.7194 12.2487 11.8045 12.3471 11.8202C12.7082 11.8777 13.0255 11.9866 13.2989 12.1469C13.3765 12.1924 13.4073 12.2892 13.3775 12.3756L13.0684 13.2725C13.0275 13.3914 12.891 13.4417 12.7812 13.3849C12.433 13.2049 12.1007 13.1149 11.7841 13.1149C11.4091 13.1149 11.2216 13.2241 11.2216 13.4425C11.2216 13.5468 11.2773 13.6262 11.3885 13.6809C11.4998 13.7305 11.6831 13.7851 11.9386 13.8447C12.2682 13.9192 12.5464 14.006 12.773 14.1053C12.9996 14.1996 13.1953 14.356 13.3602 14.5745C13.5291 14.7929 13.6136 15.0908 13.6136 15.4681C13.6136 15.8851 13.4879 16.25 13.2365 16.5628C13.0176 16.8354 12.7145 17.0262 12.3274 17.1353C12.2384 17.1604 12.1735 17.2412 12.1735 17.3358V17.8C12.1735 17.9105 12.0862 18 11.9785 18Z" fill="#000000"></path> <path fill-rule="evenodd" clip-rule="evenodd" d="M9.59235 5H13.8141C14.8954 5 14.3016 6.664 13.8638 7.679L13.3656 8.843L13.2983 9C13.7702 8.97651 14.2369 9.11054 14.6282 9.382C16.0921 10.7558 17.2802 12.4098 18.1256 14.251C18.455 14.9318 18.5857 15.6958 18.5019 16.451C18.4013 18.3759 16.8956 19.9098 15.0182 20H8.38823C6.51033 19.9125 5.0024 18.3802 4.89968 16.455C4.81587 15.6998 4.94656 14.9358 5.27603 14.255C6.12242 12.412 7.31216 10.7565 8.77823 9.382C9.1696 9.11054 9.63622 8.97651 10.1081 9L10.0301 8.819L9.54263 7.679C9.1068 6.664 8.5101 5 9.59235 5Z" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M13.2983 9.75C13.7125 9.75 14.0483 9.41421 14.0483 9C14.0483 8.58579 13.7125 8.25 13.2983 8.25V9.75ZM10.1081 8.25C9.69391 8.25 9.35812 8.58579 9.35812 9C9.35812 9.41421 9.69391 9.75 10.1081 9.75V8.25ZM15.9776 8.64988C16.3365 8.44312 16.4599 7.98455 16.2531 7.62563C16.0463 7.26671 15.5878 7.14336 15.2289 7.35012L15.9776 8.64988ZM13.3656 8.843L13.5103 9.57891L13.5125 9.57848L13.3656 8.843ZM10.0301 8.819L10.1854 8.08521L10.1786 8.08383L10.0301 8.819ZM8.166 7.34357C7.80346 7.14322 7.34715 7.27469 7.1468 7.63722C6.94644 7.99976 7.07791 8.45607 7.44045 8.65643L8.166 7.34357ZM13.2983 8.25H10.1081V9.75H13.2983V8.25ZM15.2289 7.35012C14.6019 7.71128 13.9233 7.96683 13.2187 8.10752L13.5125 9.57848C14.3778 9.40568 15.2101 9.09203 15.9776 8.64988L15.2289 7.35012ZM13.2209 8.10709C12.2175 8.30441 11.1861 8.29699 10.1854 8.08525L9.87486 9.55275C11.0732 9.80631 12.3086 9.81521 13.5103 9.57891L13.2209 8.10709ZM10.1786 8.08383C9.47587 7.94196 8.79745 7.69255 8.166 7.34357L7.44045 8.65643C8.20526 9.0791 9.02818 9.38184 9.88169 9.55417L10.1786 8.08383Z" fill="#000000"></path> </g></svg>
                                    </span>
                                    <input readonly class="input-field"  value="{{ $loan_purchase_prices[$index] ?? '' }}"  placeholder="قیمت خرید">
                                </div>
                                <div class="relative w-full md:w-1/2">
                                    <span class="absolute left-3 top-3 text-gray-400">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.75C6.89137 2.75 2.75 6.89137 2.75 12C2.75 17.1086 6.89137 21.25 12 21.25C17.1086 21.25 21.25 17.1086 21.25 12C21.25 6.89137 17.1086 2.75 12 2.75ZM1.25 12C1.25 6.06294 6.06294 1.25 12 1.25C17.9371 1.25 22.75 6.06294 22.75 12C22.75 17.9371 17.9371 22.75 12 22.75C6.06294 22.75 1.25 17.9371 1.25 12ZM12 5.25C12.4142 5.25 12.75 5.58579 12.75 6V6.31673C14.3804 6.60867 15.75 7.83361 15.75 9.5C15.75 9.91421 15.4142 10.25 15 10.25C14.5858 10.25 14.25 9.91421 14.25 9.5C14.25 8.82154 13.6859 8.10339 12.75 7.84748V11.3167C14.3804 11.6087 15.75 12.8336 15.75 14.5C15.75 16.1664 14.3804 17.3913 12.75 17.6833V18C12.75 18.4142 12.4142 18.75 12 18.75C11.5858 18.75 11.25 18.4142 11.25 18V17.6833C9.61957 17.3913 8.25 16.1664 8.25 14.5C8.25 14.0858 8.58579 13.75 9 13.75C9.41421 13.75 9.75 14.0858 9.75 14.5C9.75 15.1785 10.3141 15.8966 11.25 16.1525V12.6833C9.61957 12.3913 8.25 11.1664 8.25 9.5C8.25 7.83361 9.61957 6.60867 11.25 6.31673V6C11.25 5.58579 11.5858 5.25 12 5.25ZM11.25 7.84748C10.3141 8.10339 9.75 8.82154 9.75 9.5C9.75 10.1785 10.3141 10.8966 11.25 11.1525V7.84748ZM12.75 12.8475V16.1525C13.6859 15.8966 14.25 15.1785 14.25 14.5C14.25 13.8215 13.6859 13.1034 12.75 12.8475Z" fill="#1C274C"></path> </g></svg>
                                    </span>
                                    <input wire:model.live="loan_sale_prices.{{ $index }}"  class="input-field"  placeholder="قیمت فروش">
                                </div>
                            </div>
                            <div class="flex flex-col md:flex-row gap-4">
                                <div class="relative w-full md:w-1/2">
                                    <span class="absolute left-3 top-3 text-gray-400">
                                        <svg width="20" height="20" viewBox="-0.5 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M18 3.91992H6C3.79086 3.91992 2 5.71078 2 7.91992V17.9199C2 20.1291 3.79086 21.9199 6 21.9199H18C20.2091 21.9199 22 20.1291 22 17.9199V7.91992C22 5.71078 20.2091 3.91992 18 3.91992Z" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M7 17.9199L17 7.91992" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M8 11.9199C9.10457 11.9199 10 11.0245 10 9.91992C10 8.81535 9.10457 7.91992 8 7.91992C6.89543 7.91992 6 8.81535 6 9.91992C6 11.0245 6.89543 11.9199 8 11.9199Z" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M16 17.9199C17.1046 17.9199 18 17.0245 18 15.9199C18 14.8154 17.1046 13.9199 16 13.9199C14.8954 13.9199 14 14.8154 14 15.9199C14 17.0245 14.8954 17.9199 16 17.9199Z" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                                    </span>
                                    <input wire:model.live="loan_discount.{{ $index }}"  class="input-field"  placeholder="تخفیف">
                                </div>
                                <div class="relative w-full md:w-1/2">
                                    <span class="absolute left-3 top-3 text-gray-400">
                                        <svg fill="#000000" height="20" width="20" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 330 330" xml:space="preserve"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g id="XMLID_229_"> <path id="XMLID_230_" d="M329.946,13.925c-0.017-0.237-0.033-0.474-0.061-0.708c-0.029-0.239-0.069-0.476-0.109-0.713 c-0.042-0.252-0.083-0.504-0.138-0.752c-0.049-0.22-0.11-0.436-0.169-0.654c-0.067-0.253-0.134-0.507-0.215-0.754 c-0.07-0.218-0.155-0.432-0.236-0.647c-0.09-0.236-0.176-0.473-0.277-0.703c-0.098-0.225-0.21-0.444-0.32-0.665 c-0.105-0.211-0.207-0.424-0.321-0.629c-0.124-0.223-0.263-0.438-0.398-0.656c-0.123-0.196-0.243-0.393-0.376-0.583 c-0.141-0.204-0.295-0.4-0.447-0.598c-0.15-0.196-0.301-0.391-0.46-0.578c-0.149-0.176-0.31-0.345-0.468-0.515 c-0.186-0.198-0.372-0.393-0.568-0.582c-0.066-0.063-0.123-0.133-0.19-0.195c-0.099-0.091-0.205-0.167-0.305-0.254 c-0.205-0.181-0.413-0.356-0.628-0.526c-0.183-0.144-0.368-0.282-0.557-0.416c-0.206-0.148-0.417-0.291-0.631-0.428 c-0.206-0.132-0.413-0.258-0.624-0.379c-0.21-0.121-0.424-0.235-0.64-0.346c-0.221-0.113-0.442-0.221-0.667-0.321 c-0.221-0.099-0.443-0.191-0.668-0.279c-0.229-0.09-0.459-0.175-0.691-0.253c-0.23-0.077-0.463-0.148-0.697-0.214 c-0.237-0.067-0.476-0.129-0.716-0.184c-0.233-0.054-0.468-0.101-0.705-0.144c-0.253-0.046-0.507-0.084-0.763-0.117 c-0.227-0.029-0.454-0.053-0.684-0.072c-0.274-0.022-0.549-0.035-0.823-0.042C315.262,0.017,315.133,0,315,0h-60 c-8.284,0-15,6.716-15,15s6.716,15,15,15h25.669l-91.085,98.371l-38.978-38.978c-2.882-2.883-6.804-4.448-10.892-4.391 c-4.076,0.078-7.945,1.811-10.717,4.801l-125,134.868c-5.631,6.076-5.271,15.566,0.805,21.198 c2.888,2.676,6.545,3.999,10.193,3.999c4.03,0,8.05-1.615,11.006-4.803L140.41,121.624l38.983,38.983 c2.884,2.884,6.847,4.483,10.895,4.391c4.077-0.078,7.948-1.814,10.718-4.806L300,53.278V75c0,8.284,6.716,15,15,15 c8.284,0,15-6.716,15-15V15c0-0.094-0.012-0.184-0.014-0.277C329.981,14.457,329.965,14.191,329.946,13.925z"></path> <path id="XMLID_231_" d="M315,300H15c-8.284,0-15,6.716-15,15c0,8.284,6.716,15,15,15h300c8.284,0,15-6.716,15-15 C330,306.716,323.284,300,315,300z"></path> </g> </g></svg>
                                    </span>
                                    <input readonly  class="input-field {{ $loanProfitClass }} text-right" value="{{ $loan_profit[$index] ?? 0 }}" placeholder="سود">
                                </div>
                            </div>
                            @if((float)($loan_profit[$index] ?? 0) < 0)
                                <div class="mt-2 text-xs text-red-700">
                                    ! توجه: سود منفی است (ممکن است قیمت فروش کمتر از قیمت خرید باشد)
                                </div>
                            @endif
                            @if(count($loan_models) > 1)
                                <button type="button"
                                    wire:click="removeLoanModel({{ $index }})"
                                    class="text-red-600 text-sm mt-3">
                                    حذف
                                </button>
                            @endif
                        </div>
                    @endforeach
                    <button type="button"
                        wire:click="addLoanModel"
                        class="text-blue-600 text-sm mb-4">
                        + افزودن دستگاه
                    </button>
                @endif
                @if($table == 'cash')
                    @foreach($cash_items as $i => $row)
                        <div class="flex flex-col md:flex-row gap-4 mb-2">
                            <div class="relative w-full md:w-1/2">
                                <select wire:model="cash_customer_id" class="input-field">
                                    <option value="">انتخاب مشتری</option>
                                    @foreach($customers as $customer)
                                        <option value="{{ $customer->id }}">{{ $customer->fullname }}</option>
                                    @endforeach
                                </select>
                                @error('cash_customer_id') <span class="text-red-600 text-xs">{{ $message }}</span> @enderror
                            </div>
                            <div class="relative w-full md:w-1/2">
                                <span class="absolute left-3 top-3 text-gray-400">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <g clip-path="url(#a)" fill="#000000">
                                            <path d="M3.4 2A1.4 1.4 0 0 0 2 3.4V5a1 1 0 0 1-2 0V3.4A3.4 3.4 0 0 1 3.4 0H5a1 1 0 0 1 0 2H3.4ZM18 1a1 1 0 0 1 1-1h1.6A3.4 3.4 0 0 1 24 3.4V5a1 1 0 1 1-2 0V3.4A1.4 1.4 0 0 0 20.6 2H19a1 1 0 0 1-1-1ZM1 18a1 1 0 0 1 1 1v1.6A1.4 1.4 0 0 0 3.4 22H5a1 1 0 1 1 0 2H3.4A3.4 3.4 0 0 1 0 20.6V19a1 1 0 0 1 1-1ZM23 18a1 1 0 0 1 1 1v1.6a3.4 3.4 0 0 1-3.4 3.4H19a1 1 0 1 1 0-2h1.6a1.4 1.4 0 0 0 1.4-1.4V19a1 1 0 0 1 1-1ZM9.4 5H6.6A1.6 1.6 0 0 0 5 6.6v2.8A1.6 1.6 0 0 0 6.6 11h2.8A1.6 1.6 0 0 0 11 9.4V6.6A1.6 1.6 0 0 0 9.4 5ZM6.6 13h2.8a1.6 1.6 0 0 1 1.6 1.6v2.8A1.6 1.6 0 0 1 9.4 19H6.6A1.6 1.6 0 0 1 5 17.4v-2.8A1.6 1.6 0 0 1 6.6 13ZM17.4 5h-2.8A1.6 1.6 0 0 0 13 6.6v2.8a1.6 1.6 0 0 0 1.6 1.6h2.8A1.6 1.6 0 0 0 19 9.4V6.6A1.6 1.6 0 0 0 17.4 5ZM14.6 13h2.8a1.6 1.6 0 0 1 1.6 1.6v2.8a1.6 1.6 0 0 1-1.6 1.6h-2.8a1.6 1.6 0 0 1-1.6-1.6v-2.8a1.6 1.6 0 0 1 1.6-1.6Z"/>
                                        </g>
                                        <defs>
                                            <clipPath id="a">
                                                <path fill="#ffffff" d="M0 0h24v24H0z"/>
                                            </clipPath>
                                        </defs>
                                    </svg>
                                </span>
                                <input wire:model.live="cash_items.{{ $i }}.barcode" class="input-field" placeholder="بارکد دستگاه">
                                @error("cash_items.$i.barcode") <span class="text-red-600 text-xs">{{ $message }}</span> @enderror
                            </div>
                        </div>
                        <div class="flex flex-col md:flex-row gap-4 mb-2">
                            <div class="relative w-full md:w-1/2">
                                <span class="absolute left-3 top-3 text-gray-400">
                                <svg fill="#000000" width="20" height="20" viewBox="0 0 24 24" id="Layer_2" version="1.1" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M18.467,2.81H5.533C4.136,2.81,3,3.946,3,5.342v8.125C3,14.864,4.136,16,5.533,16h4.068l-0.483,1.468H8.513 c-1.47,0-2.667,1.196-2.667,2.667c0,0.582,0.474,1.056,1.056,1.056h10.196c0.582,0,1.056-0.474,1.056-1.056 c0-1.47-1.196-2.667-2.667-2.667h-0.594L14.46,16h4.007C19.864,16,21,14.864,21,13.467V5.342C21,3.946,19.864,2.81,18.467,2.81z M17.154,20.135c0,0.031-0.025,0.056-0.056,0.056L6.846,20.135c0-0.919,0.748-1.667,1.667-1.667H9.48h5.04h0.967 C16.406,18.468,17.154,19.216,17.154,20.135z M13.851,17.468h-3.68L10.653,16h2.765L13.851,17.468z M20,13.467 C20,14.313,19.313,15,18.467,15h-4.676h-3.5H5.533C4.688,15,4,14.313,4,13.467V5.342C4,4.497,4.688,3.81,5.533,3.81h12.935 C19.313,3.81,20,4.497,20,5.342V13.467z"></path><path d="M17.83,4.473H6.17c-0.783,0-1.42,0.637-1.42,1.42v6.771c0,0.783,0.637,1.42,1.42,1.42h11.66c0.783,0,1.42-0.637,1.42-1.42 V5.893C19.25,5.11,18.613,4.473,17.83,4.473z M18.25,12.664c0,0.231-0.188,0.42-0.42,0.42H6.17c-0.231,0-0.42-0.188-0.42-0.42V5.893 c0-0.231,0.188-0.42,0.42-0.42h11.66c0.231,0,0.42,0.188,0.42,0.42V12.664z"></path></g></svg>
                                </span>
                                <input readonly class="input-field" value="{{ $row['model'] ?? '' }}" placeholder="نام دستگاه">
                            </div>
                            <div class="relative w-full md:w-1/2">
                                <span class="absolute left-3 top-3 text-gray-400">
                                    <svg fill="#000000" width="20" height="20" viewBox="0 0 56 56" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M 47.6171 21.4023 C 48.8591 21.4023 49.5157 20.7227 49.5157 19.4805 L 49.5157 13.7383 C 49.5157 8.9102 47.0780 6.4961 42.1562 6.4961 L 36.4374 6.4961 C 35.1952 6.4961 34.5155 7.1758 34.5155 8.3711 C 34.5155 9.5898 35.1952 10.2696 36.4374 10.2696 L 42.1093 10.2696 C 44.4062 10.2696 45.7421 11.5118 45.7421 13.9492 L 45.7421 19.4805 C 45.7421 20.7227 46.4218 21.4023 47.6171 21.4023 Z M 8.3827 21.4023 C 9.6015 21.4023 10.2577 20.7227 10.2577 19.4805 L 10.2577 13.9492 C 10.2577 11.5118 11.5702 10.2696 13.9140 10.2696 L 19.5858 10.2696 C 20.8046 10.2696 21.4843 9.5898 21.4843 8.3711 C 21.4843 7.1758 20.8046 6.4961 19.5858 6.4961 L 13.8436 6.4961 C 8.9687 6.4961 6.4843 8.9102 6.4843 13.7383 L 6.4843 19.4805 C 6.4843 20.7227 7.1640 21.4023 8.3827 21.4023 Z M 17.6405 36.9649 L 19.2108 36.9649 L 19.2108 19.0352 L 17.6405 19.0352 Z M 21.2030 36.9649 L 24.1796 36.9649 L 24.1796 19.0352 L 21.2030 19.0352 Z M 25.5155 36.9649 L 27.3905 36.9649 L 27.3905 19.0352 L 25.5155 19.0352 Z M 29.0546 36.9649 L 31.9608 36.9649 L 31.9608 19.0352 L 29.0546 19.0352 Z M 33.1562 36.9649 L 35.4530 36.9649 L 35.4530 19.0352 L 33.1562 19.0352 Z M 36.2968 36.9649 L 37.7733 36.9649 L 37.7733 19.0352 L 36.2968 19.0352 Z M 13.8436 49.5039 L 19.5858 49.5039 C 20.8046 49.5039 21.4843 48.8242 21.4843 47.6289 C 21.4843 46.4102 20.8046 45.7305 19.5858 45.7305 L 13.9140 45.7305 C 11.5702 45.7305 10.2577 44.4883 10.2577 42.0508 L 10.2577 36.5196 C 10.2577 35.2774 9.5780 34.5977 8.3827 34.5977 C 7.1405 34.5977 6.4843 35.2774 6.4843 36.5196 L 6.4843 42.2383 C 6.4843 47.0898 8.9687 49.5039 13.8436 49.5039 Z M 36.4374 49.5039 L 42.1562 49.5039 C 47.0780 49.5039 49.5157 47.0664 49.5157 42.2383 L 49.5157 36.5196 C 49.5157 35.2774 48.8360 34.5977 47.6171 34.5977 C 46.3984 34.5977 45.7421 35.2774 45.7421 36.5196 L 45.7421 42.0508 C 45.7421 44.4883 44.4062 45.7305 42.1093 45.7305 L 36.4374 45.7305 C 35.1952 45.7305 34.5155 46.4102 34.5155 47.6289 C 34.5155 48.8242 35.1952 49.5039 36.4374 49.5039 Z"></path></g></svg>
                                </span>
                                <input wire:model="cash_number" readonly class="input-field" placeholder="شماره فاکتور">
                                @error('cash_number') <span class="text-red-600 text-xs">{{ $message }}</span> @enderror
                            </div>
                        </div>
                        <div class="flex flex-col md:flex-row gap-4 mb-2">
                            <div class="relative w-full md:w-1/2">
                                <span class="absolute left-3 top-3 text-gray-400">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M11.7255 17.1019C11.6265 16.8844 11.4215 16.7257 11.1734 16.6975C10.9633 16.6735 10.7576 16.6285 10.562 16.5636C10.4743 16.5341 10.392 16.5019 10.3158 16.4674L10.4424 16.1223C10.5318 16.1622 10.6239 16.1987 10.7182 16.2317L10.7221 16.2331L10.7261 16.2344C11.0287 16.3344 11.3265 16.3851 11.611 16.3851C11.8967 16.3851 12.1038 16.3468 12.2629 16.2647L12.2724 16.2598L12.2817 16.2544C12.5227 16.1161 12.661 15.8784 12.661 15.6021C12.661 15.2955 12.4956 15.041 12.2071 14.9035C12.062 14.8329 11.8559 14.7655 11.559 14.6917C11.2545 14.6147 10.9987 14.533 10.8003 14.4493C10.6553 14.3837 10.5295 14.279 10.4161 14.1293C10.3185 13.9957 10.2691 13.7948 10.2691 13.5319C10.2691 13.2147 10.3584 12.9529 10.5422 12.7315C10.7058 12.5375 10.9381 12.4057 11.2499 12.3318C11.4812 12.277 11.6616 12.1119 11.7427 11.8987C11.8344 12.1148 12.0295 12.2755 12.2723 12.3142C12.4751 12.3465 12.6613 12.398 12.8287 12.4677L12.7122 12.8059C12.3961 12.679 12.085 12.6149 11.7841 12.6149C10.7848 12.6149 10.7342 13.3043 10.7342 13.4425C10.7342 13.7421 10.896 13.9933 11.1781 14.1318L11.186 14.1357L11.194 14.1393C11.3365 14.2029 11.5387 14.2642 11.8305 14.3322C12.1322 14.4004 12.3838 14.4785 12.5815 14.5651L12.5856 14.5669L12.5897 14.5686C12.7365 14.6297 12.8624 14.7317 12.9746 14.8805L12.9764 14.8828L12.9782 14.8852C13.0763 15.012 13.1261 15.2081 13.1261 15.4681C13.1261 15.7682 13.0392 16.0222 12.8604 16.2447C12.7053 16.4377 12.4888 16.5713 12.1983 16.6531C11.974 16.7163 11.8 16.8878 11.7255 17.1019Z" fill="#000000"></path> <path d="M11.9785 18H11.497C11.3893 18 11.302 17.9105 11.302 17.8V17.3985C11.302 17.2929 11.2219 17.2061 11.1195 17.1944C10.8757 17.1667 10.6399 17.115 10.412 17.0394C10.1906 16.9648 9.99879 16.8764 9.83657 16.7739C9.76202 16.7268 9.7349 16.6312 9.76572 16.5472L10.096 15.6466C10.1405 15.5254 10.284 15.479 10.3945 15.5417C10.5437 15.6262 10.7041 15.6985 10.8755 15.7585C11.131 15.8429 11.3762 15.8851 11.611 15.8851C11.8129 15.8851 11.9572 15.8628 12.0437 15.8181C12.1302 15.7684 12.1735 15.6964 12.1735 15.6021C12.1735 15.4929 12.1158 15.411 12.0004 15.3564C11.8892 15.3018 11.7037 15.2422 11.4442 15.1777C11.1104 15.0933 10.8323 15.0039 10.6098 14.9096C10.3873 14.8103 10.1936 14.6514 10.0288 14.433C9.86396 14.2096 9.78156 13.9092 9.78156 13.5319C9.78156 13.095 9.91136 12.7202 10.1709 12.4074C10.4049 12.13 10.7279 11.9424 11.1401 11.8447C11.2329 11.8227 11.302 11.7401 11.302 11.6425V11.2C11.302 11.0895 11.3893 11 11.497 11H11.9785C12.0862 11 12.1735 11.0895 12.1735 11.2V11.6172C12.1735 11.7194 12.2487 11.8045 12.3471 11.8202C12.7082 11.8777 13.0255 11.9866 13.2989 12.1469C13.3765 12.1924 13.4073 12.2892 13.3775 12.3756L13.0684 13.2725C13.0275 13.3914 12.891 13.4417 12.7812 13.3849C12.433 13.2049 12.1007 13.1149 11.7841 13.1149C11.4091 13.1149 11.2216 13.2241 11.2216 13.4425C11.2216 13.5468 11.2773 13.6262 11.3885 13.6809C11.4998 13.7305 11.6831 13.7851 11.9386 13.8447C12.2682 13.9192 12.5464 14.006 12.773 14.1053C12.9996 14.1996 13.1953 14.356 13.3602 14.5745C13.5291 14.7929 13.6136 15.0908 13.6136 15.4681C13.6136 15.8851 13.4879 16.25 13.2365 16.5628C13.0176 16.8354 12.7145 17.0262 12.3274 17.1353C12.2384 17.1604 12.1735 17.2412 12.1735 17.3358V17.8C12.1735 17.9105 12.0862 18 11.9785 18Z" fill="#000000"></path> <path fill-rule="evenodd" clip-rule="evenodd" d="M9.59235 5H13.8141C14.8954 5 14.3016 6.664 13.8638 7.679L13.3656 8.843L13.2983 9C13.7702 8.97651 14.2369 9.11054 14.6282 9.382C16.0921 10.7558 17.2802 12.4098 18.1256 14.251C18.455 14.9318 18.5857 15.6958 18.5019 16.451C18.4013 18.3759 16.8956 19.9098 15.0182 20H8.38823C6.51033 19.9125 5.0024 18.3802 4.89968 16.455C4.81587 15.6998 4.94656 14.9358 5.27603 14.255C6.12242 12.412 7.31216 10.7565 8.77823 9.382C9.1696 9.11054 9.63622 8.97651 10.1081 9L10.0301 8.819L9.54263 7.679C9.1068 6.664 8.5101 5 9.59235 5Z" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M13.2983 9.75C13.7125 9.75 14.0483 9.41421 14.0483 9C14.0483 8.58579 13.7125 8.25 13.2983 8.25V9.75ZM10.1081 8.25C9.69391 8.25 9.35812 8.58579 9.35812 9C9.35812 9.41421 9.69391 9.75 10.1081 9.75V8.25ZM15.9776 8.64988C16.3365 8.44312 16.4599 7.98455 16.2531 7.62563C16.0463 7.26671 15.5878 7.14336 15.2289 7.35012L15.9776 8.64988ZM13.3656 8.843L13.5103 9.57891L13.5125 9.57848L13.3656 8.843ZM10.0301 8.819L10.1854 8.08521L10.1786 8.08383L10.0301 8.819ZM8.166 7.34357C7.80346 7.14322 7.34715 7.27469 7.1468 7.63722C6.94644 7.99976 7.07791 8.45607 7.44045 8.65643L8.166 7.34357ZM13.2983 8.25H10.1081V9.75H13.2983V8.25ZM15.2289 7.35012C14.6019 7.71128 13.9233 7.96683 13.2187 8.10752L13.5125 9.57848C14.3778 9.40568 15.2101 9.09203 15.9776 8.64988L15.2289 7.35012ZM13.2209 8.10709C12.2175 8.30441 11.1861 8.29699 10.1854 8.08525L9.87486 9.55275C11.0732 9.80631 12.3086 9.81521 13.5103 9.57891L13.2209 8.10709ZM10.1786 8.08383C9.47587 7.94196 8.79745 7.69255 8.166 7.34357L7.44045 8.65643C8.20526 9.0791 9.02818 9.38184 9.88169 9.55417L10.1786 8.08383Z" fill="#000000"></path> </g></svg>
                                </span>
                                <input readonly class="input-field" value="{{ $row['buy_price'] ?? '' }}" placeholder="قیمت خرید">
                            </div>
                            <div class="relative w-full md:w-1/2">
                                <span class="absolute left-3 top-3 text-gray-400">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.75C6.89137 2.75 2.75 6.89137 2.75 12C2.75 17.1086 6.89137 21.25 12 21.25C17.1086 21.25 21.25 17.1086 21.25 12C21.25 6.89137 17.1086 2.75 12 2.75ZM1.25 12C1.25 6.06294 6.06294 1.25 12 1.25C17.9371 1.25 22.75 6.06294 22.75 12C22.75 17.9371 17.9371 22.75 12 22.75C6.06294 22.75 1.25 17.9371 1.25 12ZM12 5.25C12.4142 5.25 12.75 5.58579 12.75 6V6.31673C14.3804 6.60867 15.75 7.83361 15.75 9.5C15.75 9.91421 15.4142 10.25 15 10.25C14.5858 10.25 14.25 9.91421 14.25 9.5C14.25 8.82154 13.6859 8.10339 12.75 7.84748V11.3167C14.3804 11.6087 15.75 12.8336 15.75 14.5C15.75 16.1664 14.3804 17.3913 12.75 17.6833V18C12.75 18.4142 12.4142 18.75 12 18.75C11.5858 18.75 11.25 18.4142 11.25 18V17.6833C9.61957 17.3913 8.25 16.1664 8.25 14.5C8.25 14.0858 8.58579 13.75 9 13.75C9.41421 13.75 9.75 14.0858 9.75 14.5C9.75 15.1785 10.3141 15.8966 11.25 16.1525V12.6833C9.61957 12.3913 8.25 11.1664 8.25 9.5C8.25 7.83361 9.61957 6.60867 11.25 6.31673V6C11.25 5.58579 11.5858 5.25 12 5.25ZM11.25 7.84748C10.3141 8.10339 9.75 8.82154 9.75 9.5C9.75 10.1785 10.3141 10.8966 11.25 11.1525V7.84748ZM12.75 12.8475V16.1525C13.6859 15.8966 14.25 15.1785 14.25 14.5C14.25 13.8215 13.6859 13.1034 12.75 12.8475Z" fill="#1C274C"></path> </g></svg>
                                </span>
                                <input wire:model.live="cash_items.{{ $i }}.sell_price" class="input-field" placeholder="قیمت فروش">
                            </div>
                        </div>
                        @php
                            $rowProfit = (float)($row['profit'] ?? 0);
                            $rowProfitClass =
                                ($rowProfit > 0) ? 'bg-green-100 border-green-200 text-green-800' :
                                (($rowProfit < 0) ? 'bg-red-100 border-red-200 text-red-800' :
                                'bg-gray-100 border-gray-200 text-gray-700');
                        @endphp
                        <div class="flex flex-col md:flex-row gap-4 mb-2">
                            <div class="relative w-full md:w-1/2">
                                <span class="absolute left-3 top-3 text-gray-400">
                                <svg width="20" height="20" viewBox="-0.5 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M18 3.91992H6C3.79086 3.91992 2 5.71078 2 7.91992V17.9199C2 20.1291 3.79086 21.9199 6 21.9199H18C20.2091 21.9199 22 20.1291 22 17.9199V7.91992C22 5.71078 20.2091 3.91992 18 3.91992Z" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M7 17.9199L17 7.91992" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M8 11.9199C9.10457 11.9199 10 11.0245 10 9.91992C10 8.81535 9.10457 7.91992 8 7.91992C6.89543 7.91992 6 8.81535 6 9.91992C6 11.0245 6.89543 11.9199 8 11.9199Z" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M16 17.9199C17.1046 17.9199 18 17.0245 18 15.9199C18 14.8154 17.1046 13.9199 16 13.9199C14.8954 13.9199 14 14.8154 14 15.9199C14 17.0245 14.8954 17.9199 16 17.9199Z" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                                </span>
                                <input wire:model.live="cash_items.{{ $i }}.discount" class="input-field" placeholder="تخفیف">
                            </div>
                            <div class="relative w-full md:w-1/2">
                                <span class="absolute left-3 top-3 text-gray-400">
                                <svg fill="#000000" height="20" width="20" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 330 330" xml:space="preserve"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g id="XMLID_229_"> <path id="XMLID_230_" d="M329.946,13.925c-0.017-0.237-0.033-0.474-0.061-0.708c-0.029-0.239-0.069-0.476-0.109-0.713 c-0.042-0.252-0.083-0.504-0.138-0.752c-0.049-0.22-0.11-0.436-0.169-0.654c-0.067-0.253-0.134-0.507-0.215-0.754 c-0.07-0.218-0.155-0.432-0.236-0.647c-0.09-0.236-0.176-0.473-0.277-0.703c-0.098-0.225-0.21-0.444-0.32-0.665 c-0.105-0.211-0.207-0.424-0.321-0.629c-0.124-0.223-0.263-0.438-0.398-0.656c-0.123-0.196-0.243-0.393-0.376-0.583 c-0.141-0.204-0.295-0.4-0.447-0.598c-0.15-0.196-0.301-0.391-0.46-0.578c-0.149-0.176-0.31-0.345-0.468-0.515 c-0.186-0.198-0.372-0.393-0.568-0.582c-0.066-0.063-0.123-0.133-0.19-0.195c-0.099-0.091-0.205-0.167-0.305-0.254 c-0.205-0.181-0.413-0.356-0.628-0.526c-0.183-0.144-0.368-0.282-0.557-0.416c-0.206-0.148-0.417-0.291-0.631-0.428 c-0.206-0.132-0.413-0.258-0.624-0.379c-0.21-0.121-0.424-0.235-0.64-0.346c-0.221-0.113-0.442-0.221-0.667-0.321 c-0.221-0.099-0.443-0.191-0.668-0.279c-0.229-0.09-0.459-0.175-0.691-0.253c-0.23-0.077-0.463-0.148-0.697-0.214 c-0.237-0.067-0.476-0.129-0.716-0.184c-0.233-0.054-0.468-0.101-0.705-0.144c-0.253-0.046-0.507-0.084-0.763-0.117 c-0.227-0.029-0.454-0.053-0.684-0.072c-0.274-0.022-0.549-0.035-0.823-0.042C315.262,0.017,315.133,0,315,0h-60 c-8.284,0-15,6.716-15,15s6.716,15,15,15h25.669l-91.085,98.371l-38.978-38.978c-2.882-2.883-6.804-4.448-10.892-4.391 c-4.076,0.078-7.945,1.811-10.717,4.801l-125,134.868c-5.631,6.076-5.271,15.566,0.805,21.198 c2.888,2.676,6.545,3.999,10.193,3.999c4.03,0,8.05-1.615,11.006-4.803L140.41,121.624l38.983,38.983 c2.884,2.884,6.847,4.483,10.895,4.391c4.077-0.078,7.948-1.814,10.718-4.806L300,53.278V75c0,8.284,6.716,15,15,15 c8.284,0,15-6.716,15-15V15c0-0.094-0.012-0.184-0.014-0.277C329.981,14.457,329.965,14.191,329.946,13.925z"></path> <path id="XMLID_231_" d="M315,300H15c-8.284,0-15,6.716-15,15c0,8.284,6.716,15,15,15h300c8.284,0,15-6.716,15-15 C330,306.716,323.284,300,315,300z"></path> </g> </g></svg>
                                </span>
                                <input readonly class="input-field {{ $rowProfitClass }} text-right" value="{{ $rowProfit }}" placeholder="سود">
                            </div>
                        </div>
                        @if($rowProfit < 0)
                            <div class="mb-2 text-xs text-red-700">
                                ! توجه: سود منفی است (ممکن است قیمت فروش کمتر از قیمت خرید باشد)
                            </div>
                        @endif
                        @if(count($cash_items) > 1)
                            <button type="button" wire:click="removeCashItem({{ $i }})" class="text-red-600 text-sm mb-3">
                                حذف این دستگاه
                            </button>
                        @endif
                    @endforeach
                    <button type="button" wire:click="addCashItem" class="text-blue-600 text-sm mb-4">
                        + افزودن دستگاه
                    </button>
                    <div class="relative mb-2">
                        <span class="absolute left-3 top-3 text-gray-400">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M2 14C2 10.2288 2 8.34315 3.17157 7.17157C4.34315 6 6.22876 6 10 6H14C17.7712 6 19.6569 6 20.8284 7.17157C22 8.34315 22 10.2288 22 14C22 17.7712 22 19.6569 20.8284 20.8284C19.6569 22 17.7712 22 14 22H10C6.22876 22 4.34315 22 3.17157 20.8284C2 19.6569 2 17.7712 2 14Z" stroke="#1C274C" stroke-width="1.5"></path> <path d="M16 6C16 4.11438 16 3.17157 15.4142 2.58579C14.8284 2 13.8856 2 12 2C10.1144 2 9.17157 2 8.58579 2.58579C8 3.17157 8 4.11438 8 6" stroke="#1C274C" stroke-width="1.5"></path> <path d="M12 17.3333C13.1046 17.3333 14 16.5871 14 15.6667C14 14.7462 13.1046 14 12 14C10.8954 14 10 13.2538 10 12.3333C10 11.4129 10.8954 10.6667 12 10.6667M12 17.3333C10.8954 17.3333 10 16.5871 10 15.6667M12 17.3333V18M12 10V10.6667M12 10.6667C13.1046 10.6667 14 11.4129 14 12.3333" stroke="#1C274C" stroke-width="1.5" stroke-linecap="round"></path> </g></svg>
                        </span>
                        <input readonly class="w-full input-field" value="{{ $cash_final_price }}" placeholder="مبلغ کل">
                    </div>
                    @if(false)
                        @php
                            $cp = $cash_profit ?? 0;
                            $cashProfitClass =
                                ((float)$cp > 0) ? 'bg-green-100 border-green-200 text-green-800' :
                                (((float)$cp < 0) ? 'bg-red-100 border-red-200 text-red-800' :
                                'bg-gray-100 border-gray-200 text-gray-700');
                        @endphp
                        <div class="flex flex-col md:flex-row gap-4 mb-2">
                            <div class="relative w-full md:w-1/2">
                                <select wire:model="cash_customer_id"
                                    class="input-field">
                                    <option value="">انتخاب مشتری</option>
                                    @foreach($customers as $customer)
                                        <option value="{{ $customer->id }}">
                                            {{ $customer->fullname }}
                                        </option>
                                    @endforeach
                                </select>
                                @error('cash_customer_id')
                                    <span class="text-red-600 text-xs">{{ $message }}</span>
                                @enderror
                            </div>
                        </div>
                        <div class="flex flex-col md:flex-row gap-4 mb-2">
                            <div class="relative w-full md:w-1/2">
                                <span class="absolute left-3 top-3 text-gray-400">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <g clip-path="url(#a)" fill="#000000">
                                            <path d="M3.4 2A1.4 1.4 0 0 0 2 3.4V5a1 1 0 0 1-2 0V3.4A3.4 3.4 0 0 1 3.4 0H5a1 1 0 0 1 0 2H3.4ZM18 1a1 1 0 0 1 1-1h1.6A3.4 3.4 0 0 1 24 3.4V5a1 1 0 1 1-2 0V3.4A1.4 1.4 0 0 0 20.6 2H19a1 1 0 0 1-1-1ZM1 18a1 1 0 0 1 1 1v1.6A1.4 1.4 0 0 0 3.4 22H5a1 1 0 1 1 0 2H3.4A3.4 3.4 0 0 1 0 20.6V19a1 1 0 0 1 1-1ZM23 18a1 1 0 0 1 1 1v1.6a3.4 3.4 0 0 1-3.4 3.4H19a1 1 0 1 1 0-2h1.6a1.4 1.4 0 0 0 1.4-1.4V19a1 1 0 0 1 1-1ZM9.4 5H6.6A1.6 1.6 0 0 0 5 6.6v2.8A1.6 1.6 0 0 0 6.6 11h2.8A1.6 1.6 0 0 0 11 9.4V6.6A1.6 1.6 0 0 0 9.4 5ZM6.6 13h2.8a1.6 1.6 0 0 1 1.6 1.6v2.8A1.6 1.6 0 0 1 9.4 19H6.6A1.6 1.6 0 0 1 5 17.4v-2.8A1.6 1.6 0 0 1 6.6 13ZM17.4 5h-2.8A1.6 1.6 0 0 0 13 6.6v2.8a1.6 1.6 0 0 0 1.6 1.6h2.8A1.6 1.6 0 0 0 19 9.4V6.6A1.6 1.6 0 0 0 17.4 5ZM14.6 13h2.8a1.6 1.6 0 0 1 1.6 1.6v2.8a1.6 1.6 0 0 1-1.6 1.6h-2.8a1.6 1.6 0 0 1-1.6-1.6v-2.8a1.6 1.6 0 0 1 1.6-1.6Z"/>
                                        </g>
                                        <defs>
                                            <clipPath id="a">
                                                <path fill="#ffffff" d="M0 0h24v24H0z"/>
                                            </clipPath>
                                        </defs>
                                    </svg>
                                </span>
                                <input wire:model.live="cash_barcode"
                                    class="input-field"
                                    placeholder="بارکد دستگاه">
                                @error('cash_barcode')
                                    <span class="text-red-600 text-xs">{{ $message }}</span>
                                @enderror
                            </div>
                            <div class="relative w-full md:w-1/2">
                                <span class="absolute left-3 top-3 text-gray-400">
                                    <svg fill="#000000" width="20" height="20" viewBox="0 0 24 24" id="Layer_2" version="1.1" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M18.467,2.81H5.533C4.136,2.81,3,3.946,3,5.342v8.125C3,14.864,4.136,16,5.533,16h4.068l-0.483,1.468H8.513 c-1.47,0-2.667,1.196-2.667,2.667c0,0.582,0.474,1.056,1.056,1.056h10.196c0.582,0,1.056-0.474,1.056-1.056 c0-1.47-1.196-2.667-2.667-2.667h-0.594L14.46,16h4.007C19.864,16,21,14.864,21,13.467V5.342C21,3.946,19.864,2.81,18.467,2.81z M17.154,20.135c0,0.031-0.025,0.056-0.056,0.056L6.846,20.135c0-0.919,0.748-1.667,1.667-1.667H9.48h5.04h0.967 C16.406,18.468,17.154,19.216,17.154,20.135z M13.851,17.468h-3.68L10.653,16h2.765L13.851,17.468z M20,13.467 C20,14.313,19.313,15,18.467,15h-4.676h-3.5H5.533C4.688,15,4,14.313,4,13.467V5.342C4,4.497,4.688,3.81,5.533,3.81h12.935 C19.313,3.81,20,4.497,20,5.342V13.467z"></path><path d="M17.83,4.473H6.17c-0.783,0-1.42,0.637-1.42,1.42v6.771c0,0.783,0.637,1.42,1.42,1.42h11.66c0.783,0,1.42-0.637,1.42-1.42 V5.893C19.25,5.11,18.613,4.473,17.83,4.473z M18.25,12.664c0,0.231-0.188,0.42-0.42,0.42H6.17c-0.231,0-0.42-0.188-0.42-0.42V5.893 c0-0.231,0.188-0.42,0.42-0.42h11.66c0.231,0,0.42,0.188,0.42,0.42V12.664z"></path></g></svg>
                                </span>
                                <input readonly class="input-field" value="{{ $cash_model }}"  placeholder="نام دستگاه">
                            </div>
                            <div class="relative w-full md:w-1/2">
                                <span class="absolute left-3 top-3 text-gray-400">
                                    <svg fill="#000000" width="20" height="20" viewBox="0 0 56 56" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M 47.6171 21.4023 C 48.8591 21.4023 49.5157 20.7227 49.5157 19.4805 L 49.5157 13.7383 C 49.5157 8.9102 47.0780 6.4961 42.1562 6.4961 L 36.4374 6.4961 C 35.1952 6.4961 34.5155 7.1758 34.5155 8.3711 C 34.5155 9.5898 35.1952 10.2696 36.4374 10.2696 L 42.1093 10.2696 C 44.4062 10.2696 45.7421 11.5118 45.7421 13.9492 L 45.7421 19.4805 C 45.7421 20.7227 46.4218 21.4023 47.6171 21.4023 Z M 8.3827 21.4023 C 9.6015 21.4023 10.2577 20.7227 10.2577 19.4805 L 10.2577 13.9492 C 10.2577 11.5118 11.5702 10.2696 13.9140 10.2696 L 19.5858 10.2696 C 20.8046 10.2696 21.4843 9.5898 21.4843 8.3711 C 21.4843 7.1758 20.8046 6.4961 19.5858 6.4961 L 13.8436 6.4961 C 8.9687 6.4961 6.4843 8.9102 6.4843 13.7383 L 6.4843 19.4805 C 6.4843 20.7227 7.1640 21.4023 8.3827 21.4023 Z M 17.6405 36.9649 L 19.2108 36.9649 L 19.2108 19.0352 L 17.6405 19.0352 Z M 21.2030 36.9649 L 24.1796 36.9649 L 24.1796 19.0352 L 21.2030 19.0352 Z M 25.5155 36.9649 L 27.3905 36.9649 L 27.3905 19.0352 L 25.5155 19.0352 Z M 29.0546 36.9649 L 31.9608 36.9649 L 31.9608 19.0352 L 29.0546 19.0352 Z M 33.1562 36.9649 L 35.4530 36.9649 L 35.4530 19.0352 L 33.1562 19.0352 Z M 36.2968 36.9649 L 37.7733 36.9649 L 37.7733 19.0352 L 36.2968 19.0352 Z M 13.8436 49.5039 L 19.5858 49.5039 C 20.8046 49.5039 21.4843 48.8242 21.4843 47.6289 C 21.4843 46.4102 20.8046 45.7305 19.5858 45.7305 L 13.9140 45.7305 C 11.5702 45.7305 10.2577 44.4883 10.2577 42.0508 L 10.2577 36.5196 C 10.2577 35.2774 9.5780 34.5977 8.3827 34.5977 C 7.1405 34.5977 6.4843 35.2774 6.4843 36.5196 L 6.4843 42.2383 C 6.4843 47.0898 8.9687 49.5039 13.8436 49.5039 Z M 36.4374 49.5039 L 42.1562 49.5039 C 47.0780 49.5039 49.5157 47.0664 49.5157 42.2383 L 49.5157 36.5196 C 49.5157 35.2774 48.8360 34.5977 47.6171 34.5977 C 46.3984 34.5977 45.7421 35.2774 45.7421 36.5196 L 45.7421 42.0508 C 45.7421 44.4883 44.4062 45.7305 42.1093 45.7305 L 36.4374 45.7305 C 35.1952 45.7305 34.5155 46.4102 34.5155 47.6289 C 34.5155 48.8242 35.1952 49.5039 36.4374 49.5039 Z"></path></g></svg>
                                </span>
                                <input wire:model="cash_number" readonly  class="input-field" placeholder="شماره فاکتور">
                                @error('cash_number')
                                    <span class="text-red-600 text-xs">{{ $message }}</span>
                                @enderror
                            </div>
                        </div>
                    @endif
                @endif
                <div class="flex sm:flex-row flex-col gap-3">
                    <button type="button"
                        wire:click="resetFields"
                        class="flex-1 bg-red-800 hover:bg-red-700 text-white py-2 rounded-lg">
                        لغو
                    </button>
                    <button type="button"
                        wire:click="saveAndPrint"
                        class="flex-1 bg-blue-900  hover:bg-blue-700 text-white py-2 rounded-lg">
                        ثبت و چاپ
                    </button>
                    <button type="submit"
                        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg">
                        ثبت
                    </button>
                </div>
            </form>
        </div>
    </div>
    <script>
        setTimeout(function(){
            document.querySelectorAll('.success-message')
                .forEach(el => el.remove());
        },3000);
    </script>
    <script>
        document.addEventListener('livewire:init', () => {
            Livewire.on('print-page', () => {
                window.print();
            });
        });
    </script>
</div>
